# Global Properties
quarkus.native.resources.includes=io/apicurio/registry/storage/impl/sql/h2.ddl,i18n/*.properties,io/apicurio/registry/storage/impl/sql/postgresql.ddl

## Additional index dependencies
quarkus.index-dependency.jaxrs.group-id=jakarta.ws.rs
quarkus.index-dependency.jaxrs.artifact-id=jakarta.ws.rs-api

## Name and description
registry.id=apicurio-registry
registry.name=Apicurio Registry (In Memory)
registry.description=High performance, runtime registry for schemas and API designs.
registry.version=${project.version}
registry.date=${timestamp}

## Legacy mode for ccompat API
registry.ccompat.legacy-id-mode.enabled=false

## Max # of subjects returned by ccompat API
registry.ccompat.max-subjects=1000

## Make ccompat use canonical hash
registry.ccompat.use-canonical-hash=false

##Auth - disabled by default
### Quarkus own configuration
quarkus.oidc.enabled=true
quarkus.oidc.tenant-enabled=false
quarkus.oidc.auth-server-url=https://auth.apicur.io/auth/realms/apicurio-local
quarkus.oidc.token-path=https://auth.apicur.io/auth/realms/apicurio-local/protocol/openid-connect/token/
quarkus.oidc.client-id=registry-api

### Registry specific configuration
registry.auth.role-based-authorization=false
registry.auth.owner-only-authorization=false
registry.auth.owner-only-authorization.limit-group-access=false
registry.auth.anonymous-read-access.enabled=false
registry.auth.authenticated-read-access.enabled=false
registry.auth.roles.readonly=sr-readonly
registry.auth.roles.developer=sr-developer
registry.auth.roles.admin=sr-admin
registry.auth.role-source=token
registry.auth.role-source.header.name=X-Registry-Role

# Admin override indicates whether the existence of a role somewhere
# other than the primary role source can override the 'isAdmin' logic.  This
# is useful when using role-source=application to bypass the DB check when the
# user has some existing role or other claim in their token.
registry.auth.admin-override.enabled=false
registry.auth.admin-override.from=token
registry.auth.admin-override.type=role
registry.auth.admin-override.role=sr-admin
registry.auth.admin-override.claim=org-admin
registry.auth.admin-override.claim-value=true

registry.ui.auth.oidc.clientId=default_client
registry.ui.auth.oidc.redirectUri=http://localhost:8080

quarkus.http.non-application-root-path=/

## Logging
quarkus.log.console.json=false
quarkus.log.console.format=%d{YYYY-MMx-dd HH:mm:ss} %p [%C] (%t) %m%n
quarkus.log.console.color=false
quarkus.log.min-level=TRACE
quarkus.log.category."io.quarkus.oidc.runtime.OidcProvider".level=DEBUG

## Max HTTP request body size (large files needed to support Import functionality)
## (Set to 50MB)
quarkus.http.limits.max-body-size=52428800

## Config properties
registry.config.refresh.every=1m
registry.config.cache.enabled=true

## Dynamic config properties
registry.config.dynamic.allow-all=true
registry.auth.owner-only-authorization.dynamic.allow=${registry.config.dynamic.allow-all}
registry.auth.owner-only-authorization.limit-group-access.dynamic.allow=${registry.config.dynamic.allow-all}
registry.auth.anonymous-read-access.enabled.dynamic.allow=${registry.config.dynamic.allow-all}
registry.ccompat.legacy-id-mode.enabled.dynamic.allow=${registry.config.dynamic.allow-all}
registry.ccompat.use-canonical-hash.dynamic.allow=${registry.config.dynamic.allow-all}
registry.ccompat.max-subjects.dynamic.allow=${registry.config.dynamic.allow-all}
registry.download.href.ttl.dynamic.allow=${registry.config.dynamic.allow-all}
registry.ui.features.readOnly.dynamic.allow=${registry.config.dynamic.allow-all}
registry.rest.artifact.deletion.enabled.dynamic.allow=${registry.config.dynamic.allow-all}
registry.storage.read-only.dynamic.allow=${registry.config.dynamic.allow-all}
apicurio.authn.basic-client-credentials.enabled.dynamic.allow=${registry.config.dynamic.allow-all}

# Access logs
quarkus.http.access-log.enabled=false
quarkus.http.access-log.pattern="apicurio-registry.access method="%{METHOD}" path="%{REQUEST_URL}" response_code="%{RESPONSE_CODE}" response_time="%{RESPONSE_TIME}" remote_ip="%{REMOTE_IP}" remote_user="%{REMOTE_USER}" user_agent="%{i,User-Agent}""
#this property will be used by Quarkus 2.X
quarkus.http.access-log.exclude-pattern=/health/.*

# Redirects
registry.enable-redirects=true
registry.redirects.root=/,/apis


quarkus.http.proxy.proxy-address-forwarding=false

## A way to disable some of the supported APIs if desired
#registry.disable.apis=

## Include or exclude the stack trace in REST API error responses.
registry.api.errors.include-stack-in-response=false

## Enable CORS always
quarkus.http.cors=true
quarkus.http.cors.origins=http://localhost:8888,http://127.0.0.1:8888
quarkus.http.cors.methods=GET,PUT,POST,PATCH,DELETE,OPTIONS
quarkus.http.cors.headers=x-registry-name,x-registry-name-encoded,x-registry-description,x-registry-description-encoded,x-registry-version,x-registry-artifactid,x-registry-artifacttype,x-registry-hash-algorithm,x-registry-content-hash,access-control-request-method,access-control-allow-credentials,access-control-allow-origin,access-control-allow-headers,authorization,content-type

## Disable Quarkus proactive authentication
quarkus.http.auth.proactive=false

## Disable OpenAPI class scanning
mp.openapi.scan.disable=true
mp.openapi.servers=/api

registry.storage.metrics.cache.check-period=30000
registry.limits.config.cache.check-period=30000
registry.storage.metrics.cache.max-size=1000

registry.downloads.reaper.every=60s

quarkus.native.additional-build-args=--initialize-at-run-time=org.apache.kafka.common.security.authenticator.SaslClientAuthenticator\\,org.eclipse.jgit\\,org.h2\\,org.postgres\\,com.microsoft.sqlserver\\,\
  --allow-incomplete-classpath

# Artifact download
registry.rest.artifact.download.maxSize=1000000
registry.rest.artifact.download.skipSSLValidation=false

# Artifact version deletion
registry.rest.artifact.deletion.enabled=false

# Api date format
registry.apis.v2.date-format=yyyy-MM-dd'T'HH:mm:ss'Z'
registry.apis.v2.date-format-timezone=UTC

yyyy-MM-dd'T'HH:mm:ss'Z'

# Common components properties
apicurio.name=${registry.id}
apicurio.description=${registry.description}
apicurio.version=${registry.version}
apicurio.date=${registry.date}

apicurio.authn.basic-client-credentials.enabled=false
apicurio.authn.basic-client-credentials.cache-expiration=5
apicurio.authn.audit.log.prefix=registry.audit


# Storage properties
registry.storage.kind=sql

## SQL Storage
registry.storage.db-kind=h2
registry.datasource.url=jdbc:h2:mem:registry_db
registry.datasource.username=sa
registry.datasource.password=sa
registry.datasource.jdbc.initial-size=20
registry.datasource.jdbc.min-size=20
registry.datasource.jdbc.max-size=100

registry.sql.init=true

quarkus.test.flat-class-path=true

## Kafka SQL storage

registry.kafkasql.bootstrap.servers=localhost:9092
registry.kafkasql.topic=kafkasql-journal
registry.kafkasql.producer.client.id=${registry.id}-producer
registry.kafkasql.consumer.poll.timeout=100
registry.kafkasql.consumer.group.id=${registry.id}-${quarkus.uuid}

# Security
registry.kafkasql.security.sasl.enabled=false
registry.kafkasql.security.sasl.mechanism=OAUTHBEARER
registry.kafkasql.security.sasl.client-id=sa
registry.kafkasql.security.sasl.client-secret=sa
registry.kafkasql.security.sasl.token.endpoint=http://localhost:8090
registry.kafkasql.security.sasl.login.callback.handler.class=io.strimzi.kafka.oauth.client.JaasClientOauthLoginCallbackHandler

## Gitops

registry.datasource.blue.db-kind=h2
registry.datasource.blue.jdbc.url=jdbc:h2:mem:registry_blue
registry.datasource.blue.username=sa
registry.datasource.blue.password=sa
registry.datasource.blue.jdbc.initial-size=20
registry.datasource.blue.jdbc.min-size=20
registry.datasource.blue.jdbc.max-size=100

registry.datasource.green.db-kind=h2
registry.datasource.green.jdbc.url=jdbc:h2:mem:registry_green
registry.datasource.green.username=sa
registry.datasource.green.password=sa
registry.datasource.green.jdbc.initial-size=20
registry.datasource.green.jdbc.min-size=20
registry.datasource.green.jdbc.max-size=100

registry.gitops.id=main
registry.gitops.repo.origin.uri=http://localhost
registry.gitops.repo.origin.branch=main
registry.gitops.refresh.every=30s
