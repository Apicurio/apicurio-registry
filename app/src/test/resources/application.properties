# =============================================================================
# Test Configuration for Apicurio Registry
# =============================================================================
# This file configures Quarkus DevServices for automatic container management
# during tests. Containers are shared across tests with the same profile,
# significantly reducing test execution time.

# -----------------------------------------------------------------------------
# DevServices - Disabled by Default (for fast unit tests)
# -----------------------------------------------------------------------------
# Unit tests use in-memory storage and don't need containers.
# DevServices is enabled per-profile for tests that require infrastructure.
quarkus.devservices.enabled=false

# -----------------------------------------------------------------------------
# Kafka DevServices Configuration
# -----------------------------------------------------------------------------
# Activated by profiles that need Kafka (kafkasql, kafkasqlauth, kafkasqlevents)

# KafkaSQL profile - basic Kafka storage tests
%kafkasql.quarkus.devservices.enabled=true
%kafkasql.quarkus.kafka.devservices.enabled=true
%kafkasql.quarkus.kafka.devservices.image-name=quay.io/strimzi/kafka:latest-kafka-3.6.0
%kafkasql.quarkus.kafka.devservices.topic-partitions.kafkasql-journal=1
%kafkasql.quarkus.kafka.devservices.topic-partitions.kafkasql-snapshots=1
%kafkasql.quarkus.kafka.devservices.service-name=kafka
%kafkasql.quarkus.kafka.devservices.shared=true

# KafkaSQL + Auth profile - Kafka with authentication tests
%kafkasqlauth.quarkus.devservices.enabled=true
%kafkasqlauth.quarkus.kafka.devservices.enabled=true
%kafkasqlauth.quarkus.kafka.devservices.image-name=quay.io/strimzi/kafka:latest-kafka-3.6.0
%kafkasqlauth.quarkus.kafka.devservices.topic-partitions.kafkasql-journal=1
%kafkasqlauth.quarkus.kafka.devservices.topic-partitions.kafkasql-snapshots=1
%kafkasqlauth.quarkus.kafka.devservices.service-name=kafka
%kafkasqlauth.quarkus.kafka.devservices.shared=true

# KafkaSQL Events profile - Kafka event streaming tests
%kafkasqlevents.quarkus.devservices.enabled=true
%kafkasqlevents.quarkus.kafka.devservices.enabled=true
%kafkasqlevents.quarkus.kafka.devservices.image-name=quay.io/strimzi/kafka:latest-kafka-3.6.0
%kafkasqlevents.quarkus.kafka.devservices.topic-partitions.kafkasql-journal=1
%kafkasqlevents.quarkus.kafka.devservices.topic-partitions.kafkasql-snapshots=1
%kafkasqlevents.quarkus.kafka.devservices.service-name=kafka
%kafkasqlevents.quarkus.kafka.devservices.shared=true

# KafkaSQL Snapshot profile - Kafka snapshot tests
%kafkasqlsnapshot.quarkus.devservices.enabled=true
%kafkasqlsnapshot.quarkus.kafka.devservices.enabled=true
%kafkasqlsnapshot.quarkus.kafka.devservices.image-name=quay.io/strimzi/kafka:latest-kafka-3.6.0
%kafkasqlsnapshot.quarkus.kafka.devservices.topic-partitions.kafkasql-journal=1
%kafkasqlsnapshot.quarkus.kafka.devservices.topic-partitions.kafkasql-snapshots=1
%kafkasqlsnapshot.quarkus.kafka.devservices.service-name=kafka
%kafkasqlsnapshot.quarkus.kafka.devservices.shared=true

# -----------------------------------------------------------------------------
# Keycloak DevServices Configuration
# -----------------------------------------------------------------------------
# Activated by profiles that need authentication (auth and variants)

# Base auth profile - standard authentication tests
%auth.quarkus.devservices.enabled=true
%auth.quarkus.keycloak.devservices.enabled=true
%auth.quarkus.keycloak.devservices.image-name=quay.io/keycloak/keycloak:26.1.0
%auth.quarkus.keycloak.devservices.realm-path=realm.json
%auth.quarkus.keycloak.devservices.realm-name=registry
%auth.quarkus.keycloak.devservices.service-name=keycloak
%auth.quarkus.keycloak.devservices.shared=true
%auth.quarkus.keycloak.devservices.grant.type=CLIENT_CREDENTIALS

# Auth with local roles profile
%authlocalroles.quarkus.devservices.enabled=true
%authlocalroles.quarkus.keycloak.devservices.enabled=true
%authlocalroles.quarkus.keycloak.devservices.image-name=quay.io/keycloak/keycloak:26.1.0
%authlocalroles.quarkus.keycloak.devservices.realm-path=realm.json
%authlocalroles.quarkus.keycloak.devservices.realm-name=registry
%authlocalroles.quarkus.keycloak.devservices.service-name=keycloak
%authlocalroles.quarkus.keycloak.devservices.shared=true

# Auth with authenticated read access profile
%authauthenticatedread.quarkus.devservices.enabled=true
%authauthenticatedread.quarkus.keycloak.devservices.enabled=true
%authauthenticatedread.quarkus.keycloak.devservices.image-name=quay.io/keycloak/keycloak:26.1.0
%authauthenticatedread.quarkus.keycloak.devservices.realm-path=realm.json
%authauthenticatedread.quarkus.keycloak.devservices.realm-name=registry
%authauthenticatedread.quarkus.keycloak.devservices.service-name=keycloak
%authauthenticatedread.quarkus.keycloak.devservices.shared=true

# Auth with anonymous credentials profile
%authanonymous.quarkus.devservices.enabled=true
%authanonymous.quarkus.keycloak.devservices.enabled=true
%authanonymous.quarkus.keycloak.devservices.image-name=quay.io/keycloak/keycloak:26.1.0
%authanonymous.quarkus.keycloak.devservices.realm-path=realm.json
%authanonymous.quarkus.keycloak.devservices.realm-name=registry
%authanonymous.quarkus.keycloak.devservices.service-name=keycloak
%authanonymous.quarkus.keycloak.devservices.shared=true

# Auth with header roles profile
%authheaderroles.quarkus.devservices.enabled=true
%authheaderroles.quarkus.keycloak.devservices.enabled=true
%authheaderroles.quarkus.keycloak.devservices.image-name=quay.io/keycloak/keycloak:26.1.0
%authheaderroles.quarkus.keycloak.devservices.realm-path=realm.json
%authheaderroles.quarkus.keycloak.devservices.realm-name=registry
%authheaderroles.quarkus.keycloak.devservices.service-name=keycloak
%authheaderroles.quarkus.keycloak.devservices.shared=true

# Basic auth with properties profile
%authbasic.quarkus.devservices.enabled=true
%authbasic.quarkus.keycloak.devservices.enabled=true
%authbasic.quarkus.keycloak.devservices.image-name=quay.io/keycloak/keycloak:26.1.0
%authbasic.quarkus.keycloak.devservices.realm-path=realm.json
%authbasic.quarkus.keycloak.devservices.realm-name=registry
%authbasic.quarkus.keycloak.devservices.service-name=keycloak
%authbasic.quarkus.keycloak.devservices.shared=true

# Combined KafkaSQL + Auth profile
%kafkasqlauth.quarkus.keycloak.devservices.enabled=true
%kafkasqlauth.quarkus.keycloak.devservices.image-name=quay.io/keycloak/keycloak:26.1.0
%kafkasqlauth.quarkus.keycloak.devservices.realm-path=realm.json
%kafkasqlauth.quarkus.keycloak.devservices.realm-name=registry
%kafkasqlauth.quarkus.keycloak.devservices.service-name=keycloak
%kafkasqlauth.quarkus.keycloak.devservices.shared=true

# -----------------------------------------------------------------------------
# OIDC Configuration for Auth Profiles
# -----------------------------------------------------------------------------
# These settings are applied when Keycloak DevServices starts

%auth.quarkus.oidc.tenant-enabled=true
%auth.quarkus.oidc.client-id=registry-api
%auth.apicurio.auth.role-based-authorization=true
%auth.apicurio.auth.owner-only-authorization=true
%auth.apicurio.auth.admin-override.enabled=true
%auth.apicurio.authn.basic-client-credentials.enabled=true

%authlocalroles.quarkus.oidc.tenant-enabled=true
%authlocalroles.quarkus.oidc.client-id=registry-api
%authlocalroles.apicurio.auth.role-based-authorization=true
%authlocalroles.apicurio.auth.owner-only-authorization=true
%authlocalroles.apicurio.auth.admin-override.enabled=true
%authlocalroles.apicurio.authn.basic-client-credentials.enabled=true
%authlocalroles.apicurio.auth.role-source=application

%authauthenticatedread.quarkus.oidc.tenant-enabled=true
%authauthenticatedread.quarkus.oidc.client-id=registry-api
%authauthenticatedread.apicurio.auth.role-based-authorization=true
%authauthenticatedread.apicurio.auth.owner-only-authorization=true
%authauthenticatedread.apicurio.auth.admin-override.enabled=true
%authauthenticatedread.apicurio.authn.basic-client-credentials.enabled=true
%authauthenticatedread.apicurio.auth.authenticated-read-access.enabled=true

%authanonymous.quarkus.oidc.tenant-enabled=true
%authanonymous.quarkus.oidc.client-id=registry-api
%authanonymous.apicurio.auth.role-based-authorization=true
%authanonymous.apicurio.auth.owner-only-authorization=true
%authanonymous.apicurio.auth.admin-override.enabled=true
%authanonymous.apicurio.authn.basic-client-credentials.enabled=true
%authanonymous.apicurio.auth.anonymous-read-access.enabled=true

%authheaderroles.quarkus.oidc.tenant-enabled=true
%authheaderroles.quarkus.oidc.client-id=registry-api
%authheaderroles.apicurio.auth.role-based-authorization=true
%authheaderroles.apicurio.auth.owner-only-authorization=true
%authheaderroles.apicurio.auth.admin-override.enabled=true
%authheaderroles.apicurio.authn.basic-client-credentials.enabled=true
%authheaderroles.apicurio.auth.role-source=header

%authbasic.quarkus.oidc.tenant-enabled=true
%authbasic.quarkus.oidc.client-id=registry-api
%authbasic.apicurio.auth.role-based-authorization=true
%authbasic.apicurio.auth.owner-only-authorization=true
%authbasic.apicurio.auth.admin-override.enabled=true
%authbasic.apicurio.authn.basic-client-credentials.enabled=true

%kafkasqlauth.quarkus.oidc.tenant-enabled=true
%kafkasqlauth.quarkus.oidc.client-id=registry-api
%kafkasqlauth.apicurio.auth.role-based-authorization=true
%kafkasqlauth.apicurio.auth.owner-only-authorization=true
%kafkasqlauth.apicurio.auth.admin-override.enabled=true
%kafkasqlauth.apicurio.authn.basic-client-credentials.enabled=true

# -----------------------------------------------------------------------------
# Test Client IDs (defined in realm.json)
# -----------------------------------------------------------------------------
# These match the client definitions in the Keycloak realm
test.keycloak.admin-client-id=admin-client
test.keycloak.developer-client-id=developer-client
test.keycloak.developer-2-client-id=developer-2-client
test.keycloak.readonly-client-id=readonly-client
test.keycloak.no-role-client-id=no-role-client
test.keycloak.wrong-creds-client-id=wrong-client

# -----------------------------------------------------------------------------
# Common Test Configuration
# -----------------------------------------------------------------------------
# Allow deletion operations in tests
%test.apicurio.rest.deletion.group.enabled=true
%test.apicurio.rest.deletion.artifact.enabled=true
%test.apicurio.rest.deletion.artifact-version.enabled=true

# -----------------------------------------------------------------------------
# Notes
# -----------------------------------------------------------------------------
# TLS Authentication Tests:
#   TlsAuthTestProfile still uses KeycloakTestContainerManager with TLS config
#   because DevServices doesn't support custom TLS certificates.
#
# Container Reuse:
#   For faster subsequent test runs, add to ~/.testcontainers.properties:
#   testcontainers.reuse.enable=true
#
# Cluster Tests:
#   When running with -Dcluster.tests=true, DevServices should be disabled
#   as external infrastructure is used. Profiles handle this automatically.
