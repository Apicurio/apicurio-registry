# Application configuration
quarkus.application.name=greeting-consumer

# HTTP server
quarkus.http.port=8080

# Kafka configuration
kafka.bootstrap.servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}

# Incoming channel configuration for greetings topic
mp.messaging.incoming.greetings-in.connector=smallrye-kafka
mp.messaging.incoming.greetings-in.topic=greetings
mp.messaging.incoming.greetings-in.value.deserializer=io.apicurio.registry.serde.avro.AvroKafkaDeserializer
mp.messaging.incoming.greetings-in.key.deserializer=org.apache.kafka.common.serialization.StringDeserializer
mp.messaging.incoming.greetings-in.auto.offset.reset=earliest
mp.messaging.incoming.greetings-in.group.id=greeting-consumer-group
mp.messaging.incoming.greetings-in.failure-strategy=ignore

# Apicurio Registry configuration for deserializer
mp.messaging.incoming.greetings-in.apicurio.registry.url=${APICURIO_REGISTRY_URL:http://localhost:8080/apis/registry/v3}
mp.messaging.incoming.greetings-in.apicurio.registry.as-confluent=false
mp.messaging.incoming.greetings-in.apicurio.registry.use-specific-avro-reader=true

# OpenTelemetry configuration
quarkus.otel.enabled=true
quarkus.otel.service.name=${QUARKUS_OTEL_SERVICE_NAME:greeting-consumer}
quarkus.otel.exporter.otlp.endpoint=${QUARKUS_OTEL_EXPORTER_OTLP_ENDPOINT:http://localhost:4317}
quarkus.otel.exporter.otlp.protocol=grpc
quarkus.otel.traces.enabled=true
quarkus.otel.traces.sampler=parentbased_always_on
quarkus.otel.metrics.enabled=true
quarkus.otel.logs.enabled=false

# Enable Kafka instrumentation for trace context extraction
quarkus.otel.instrument.kafka=true

# Resource attributes for better trace identification
quarkus.otel.resource.attributes=service.version=1.0.0,deployment.environment=${DEPLOYMENT_ENV:local}

# Logging with trace context
quarkus.log.console.format=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p traceId=%X{traceId}, spanId=%X{spanId} [%c{3.}] (%t) %s%e%n
quarkus.log.console.level=INFO
quarkus.log.category."io.apicurio".level=DEBUG
quarkus.log.category."io.opentelemetry".level=INFO

# Health checks
quarkus.health.extensions.enabled=true
