apiVersion: v1
kind: Secret
metadata:
  name: keycloak-tls
type: kubernetes.io/tls
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQvakNDQXVhZ0F3SUJBZ0lVVHNkUjVKQ1JMWng4Z05uNS9IYzRMbGU5cEI4d0RRWUpLb1pJaHZjTkFRRUwKQlFBd2RERUxNQWtHQTFVRUJoTUNWVk14Q3pBSkJnTlZCQWdNQWtOQk1SWXdGQVlEVlFRSERBMVRZVzRnUm5KaApibU5wYzJOdk1SRXdEd1lEVlFRS0RBaExaWGxqYkc5aGF6RXRNQ3NHQTFVRUF3d2tjMmx0Y0d4bExXdGxlV05zCmIyRnJMbUZ3Y0hNdVkyeDFjM1JsY2k1bGVHRnRjR3hsTUI0WERUSTFNREV6TVRBM01qSTFNVm9YRFRJMk1ERXoKTVRBM01qSTFNVm93ZERFTE1Ba0dBMVVFQmhNQ1ZWTXhDekFKQmdOVkJBZ01Ba05CTVJZd0ZBWURWUVFIREExVApZVzRnUm5KaGJtTnBjMk52TVJFd0R3WURWUVFLREFoTFpYbGpiRzloYXpFdE1Dc0dBMVVFQXd3a2MybHRjR3hsCkxXdGxlV05zYjJGckxtRndjSE11WTJ4MWMzUmxjaTVsZUdGdGNHeGxNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUYKQUFPQ0FROEFNSUlCQ2dLQ0FRRUFxMUtvdXk3UlRtZmlnWDhwZmdJdERvcUFadEJ4UW1YbDh5cUxzZk5JYWJjeQptRldEcHRBZVpRRXJHTU9qRG96U1BiZlBhY1RCUnIvQ0J0T2hOcEd4b2pNTjdGOWdIMGFaRFFmTm14RDVsQkpiClJJS0Q2cGN2U2VTNWZrUCtHS3RwMHd0ZmpURzI3a0E0MStLMHVZdVZPQUhERHdlRU9qUUlpdVVYNDB5Wmlsa3gKeGs5VGF0ejBCZ3B0VVc2V0xZMU1ZWWZqdTB3SGRmTWYxb0diREJ1WDhsQ0dGK3ZIV3B5RUFSamZZQnJ4S0dZYQpVVys5SXN1aTJZbk9YSUR5Q0RabmdQMWN0bXQramM3SlpDUFpkQWtQUzJJOHcvV0xMbVFldHJ5dm5TZGQrUnVuCnZJUGhhRXZhV1YwMTh0dk9BMjRqOHNSVG0xVDdOUGp2RlFvREphY2I5UUlEQVFBQm80R0hNSUdFTUdNR0ExVWQKRVFSY01GcUNKSE5wYlhCc1pTMXJaWGxqYkc5aGF5NWhjSEJ6TG1Oc2RYTjBaWEl1WlhoaGJYQnNaWUlJYTJWNQpZMnh2WVd1Q0RHdGxlV05zYjJGckxuTjJZNElhYTJWNVkyeHZZV3N1YzNaakxtTnNkWE4wWlhJdWJHOWpZV3d3CkhRWURWUjBPQkJZRUZLbng1SGM2RGZVcUlhWGMyZnZxNkZiVkc2V1BNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUIKQVFBTUVjWUFnTDdUMUlRZEcxMnBudndEUDFyY05lSUdkUGdabFZsbVh2dk01N01HSFZQMDZEMlNrYnlBaVFsUQpyNk9oemU0b1MrOVZjcmtxQXFvbzJIMy9mUFQvZEZMeXdxclhXNDdicy83YUV0RDdiR25md0NrZ1MybWhuNFpLCjl2cFdScnJLUTRaQUc4WUc0ckpGYnNhTU5BaE1CL2pvVWpqTGg2MFJvUW5EZFdteWhBYmwwN0FSekNRd3V2OE0KRHZwenJNaS9VOG5CRmx2VVBSZUlwc2VqajlIQXl5ZlJCdjJkSndTWkdMeEZPYjJmbFNJeFNDOGFhYUo4TlFtRApUWmVaSW54dFV2SHdFbm5IMHU1cEIzd0UrdThOa2xHU3U3WG8zY3RLKzlxNENiNTF2R2Fwd2Q2ZGh0am5tbG14CmdnODJTdGFMMW45azAxUmh1OWtlWEEzSgotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRQ3JVcWk3THRGT1orS0IKZnlsK0FpME9pb0JtMEhGQ1plWHpLb3V4ODBocHR6S1lWWU9tMEI1bEFTc1l3Nk1Pak5JOXQ4OXB4TUZHdjhJRwowNkUya2JHaU13M3NYMkFmUnBrTkI4MmJFUG1VRWx0RWdvUHFseTlKNUxsK1EvNFlxMm5UQzErTk1iYnVRRGpYCjRyUzVpNVU0QWNNUEI0UTZOQWlLNVJmalRKbUtXVEhHVDFOcTNQUUdDbTFSYnBZdGpVeGhoK083VEFkMTh4L1cKZ1pzTUc1ZnlVSVlYNjhkYW5JUUJHTjlnR3ZFb1pocFJiNzBpeTZMWmljNWNnUElJTm1lQS9WeTJhMzZOenNsawpJOWwwQ1E5TFlqekQ5WXN1WkI2MnZLK2RKMTM1RzZlOGcrRm9TOXBaWFRYeTI4NERiaVB5eEZPYlZQczArTzhWCkNnTWxweHYxQWdNQkFBRUNnZ0VBQVdiL1A3RTVKZWJpYnRjMzFIYUtnaXNiNGFpOVRZaWdaektsS1ZGSm4wNEYKQmExc3p6M1VzSExKWWRoTi9VblN6SDd3L3o4RlFTbFNYam4rOFoyNlZCM0RDeGN1UzY2Sk9ZZnU2SldsZkdXMAp4akNVbUg1c2ZIWmlqeUozM3hKNFd2Vmg5a2pDY3o1RXpZejl4UzdxenhjY1hkWGN4S2hmSkR3azhROG01UTczCnhMRkNLWHl6aEV2VS9iWEkxYnBJaUhVUjI1OXU4R3FWU2RBLzlsVEhxQ1J2OUh0R0w4bWZaNjZXbmNtdnVJYTgKQWg4RThmbFIxMFRvdGFyeDE2MFhoZVZ2SWZHMHpJWHNqRU9ydWZpU09VZzZNTkI3Ukt6UGxyemxwemRNSXhndwpFbXcwR0t1MlZpRFY0YmhGeWpJVmF2Und3TnpNbFF0Q2hja0k3NlBKRVFLQmdRRFpIcmlsQ25WUHVCTVgwOWd4Cm8vdy9Wb0RubEd2VjhGcVdnTmxEaEQ2bUdQdEVSd3JWc0lGc0xCMzBOUGZKQ2JxL1k0NlFXRkFEWE1lUVV6MFcKVnV4OHZtYkhIYW53QzNJUmdzTEVJZWlBYVNyalNvd0dJM25ScWdXRDIyUXNxUElWSE1nMTA1VDFEVlFoUFRVNQo1eG52NEpxVHpwY2ZNYllKaWw4TzVleXVMUUtCZ1FES0FINHpyeXRNd0FZRXl0bUUwR1FxaXp6bWtqSCtNYndvCitMeHNCc2s2NW8xUDNNaTFRTFFNVk9ESUp1aU5paVkxWldWUnB3QUttOVBCVWF3dWkyL3hnTVEzR0dCM2lReVUKN09rYjhzQjVWcU9RbllPekFXclQ1WjVMbEE2bU9pNTlkaGo4VGhRK3A3dmhBTThxYUdFaDUzbytaaVI4NlJOYQpmclc1NnJFSjZRS0JnQU50eThhM2VwRE92R1owN3dZaHE5c29ONUx3c2g5SDAzWnJCSU5mZEVuVlBTcWY0Smp0ClY2M29xSFJ4M2JQc0ZtbnRYWlFFQVFkOGtKNUQ0a1FYRFZjTy9ycUlTbVhER0lNVVNKVW1YL0NmT0pFc1hUZS8KbWEzby9IdFBuSzVqNEtiYXRJSzlHNjRmRHNRVG5tS1N0c01tRGVybHFWZFJ4cWt4NlR4bi95dmxBb0dBSTRPRwpySXVGYjA3clAvaHgyWm5Sb25Fc1dkVW1HT3loaWdxQkJmVURkK21FdXArMFlibG9iaXFXQWxwazFFMlBmaCsvCmVtV0Q2bG1QRnhQRzA4QU1CRWVCTjdaL2IwU1hBNi9MSS9DL3loVmpXRTk1RWdXVHhJRkFIVVdBZGRVUXkxbngKOXBtN2tYQm41WjBBenhIZTBka2ljc24rYkQrRitZa0JaaGhPMjlFQ2dZRUFwTlhxRVZ5NUdsa0pOWjBKZS9YVwp6ZHpMdkl0eEZObWxKMkpuaGtWdmMxRXJ3RlovQ3l0SGdwMnQ1aUZQTXFoYThhSnRsdzVkVDJBZno4bWtHWnc5CmRmMmozaTljWU00cDdXbm9SMkZ0TERsTjdEY1lrK0tDSHYvMTlycjdOVXhOZ0NJc3Q5SHhod0FGeEt4djBmSEoKRUVJdjRiNkQwU25JOTFRQnk0T1JIVEk9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0=
---
apiVersion: v1
kind: Secret
metadata:
  name: keycloak-truststore
data:
  truststore: MIIFcgIBAzCCBRwGCSqGSIb3DQEHAaCCBQ0EggUJMIIFBTCCBQEGCSqGSIb3DQEHBqCCBPIwggTuAgEAMIIE5wYJKoZIhvcNAQcBMGYGCSqGSIb3DQEFDTBZMDgGCSqGSIb3DQEFDDArBBTWDbaAWuj7/2kDLsPby+f+u/1Z3AICJxACASAwDAYIKoZIhvcNAgkFADAdBglghkgBZQMEASoEECppmZjl3PrTBtH62M3mmFmAggRwW9sTJl6adVUupqaTBWcRXpGPOkt3XB6f7roOvxTEBNjTulERNlTQxeWVi/OctAF0qzlavQebsmkgFDRkRrbyvAXgQKHYH3wlcnQCg2IcVbAPfyUkQksKqjAqCZaCDeMJLamgSEHuSO8Mr9ghLaGgOxeq0QK+DtkVQB8Ejkdb27VljHtYaxmdyDhqbtF3mIh5NTtkXWBL4I3XR77dYMtbdZYcMdnriJPxW1g1c02zCQ80WzxtvbJIkR03RyMHvwqpI2GbPpWMwuIw1NhpiFm7ho2leZj40hlzg4TkgvKiscxcRtnU9ZbztQyHGFg1oYLK6iUCaw5x6w9Kae5F7ChKMMvARgUuk5rlUwVd9TWQnfp6ZShpXRJtR0YKxge/CxQK87hpB1v0w8q9lIXf0QwUnueUTr7ffnu4f2oI7bZ0JDBvuTUU6U1xJuwZ90IoerhdfCvGNBdjwENTl7K45E26qLONzm41zCdihVkRG3oG7Oc4GWr1oh9qqnzn5X3bJp3iyYdUPbwrsh0Lt3BQNTJ9KOymJJGcJuG72LV+2KEhicF2sl8EgkI7mWhwTVGJfgDD+MIeG1lzL46USTl2EtBT9Nio3T/VWwwV4bpGEHSAo67WDqu/kKj59+2WZvH/uP67qpGYkvEQiztILJQFGYa4Kra4xQ3U+mCs3SMyS17x9qPEcnizivuUn6okrUqJjiiqpfsFT0uuX/YE18dyQ9BRAyXY32YnLaa4YS7tg1OBl8ufdfwLSsABd4i8472B4j9Y+mL44KGoRbo9dci97+y4LbbaqWKsX3v3Bs7Dtmpgrsl+pDCS3ChWhjWirtTKLMfRojFJOtv8DpdwNgWPjNX3/L5S0bonk0CIOn2FveiGnH0YSeK79++32DzEitBLY3mfIB45uFZPVhaX86EGi97k6H/GPh8kwBg61pt6lc0zFkaRXQCajngnoJ+jSnN8at6WFfXfayx5WxJP3Ryrndu1bI3AMCLHcEIMwy2IOQTQgOYT9YdgHqRTkMGyq9jphsGyQLdQQjNMC2TplLPrKjKBm9/rQdeVv7DIVWG/jfGn162Hm1C8knvxJhlRfel2tYAcp6HAkU/M7K1a5bsvL2n1BBFOYUwM2Tthkm148NGaH9SuQfQepSo52oC2H2Ycd854z+FTb2Uhq0RkVNWxrT1tG1nlvjGdeMCvdBoak1GNaePXXHKb5CwCIckpRiIdBzwvyF7AHNI87xqY0Q006oUGFhFMLYDi822cd/rcapjHa6sTY/cbWUge4b5d7KqKvJqARY4Fb2sVfokhEx2Fogj36iR6ipg/y2lJGcWFLOllU3nHPRpXvn/LEYAhF9c3xBBGN3XjuBIrNeTg275R/yAI4hIzHri58t7L1XPSCdJK5uBf1nkEaYKxDuJ+0cEtdKyPrRIHRJ8dgilxqPsST5stC26Bjw8ZZG+GHO++ha3WqCAl6eBC/RThLYpHUlrMEc3tnId85gDKDnPthW2bZzMuE0+5QUceATeejXQNc+yOcwcwTTAxMA0GCWCGSAFlAwQCAQUABCBEWEfkGKp/2eG5VysVzM8H1XxQKWPhycOyr4tl50hxDQQUxZwV85wj5XqTVYXuRyOl8C7kFQwCAicQ
  password: YXBpY3VyaW8=
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: keycloak
  labels:
    app: keycloak
spec:
  replicas: 1
  selector:
    matchLabels:
      app: keycloak
  template:
    metadata:
      labels:
        app: keycloak
    spec:
      containers:
        - name: keycloak
          image: quay.io/keycloak/keycloak:26.1.0
          args: ["start-dev", "--import-realm"]
          env:
            - name: KC_HOSTNAME
              value: "simple-keycloak.apps.cluster.example"
            - name: KC_BOOTSTRAP_ADMIN_USERNAME
              value: "admin"
            - name: KC_BOOTSTRAP_ADMIN_PASSWORD
              value: "admin"
            - name: KC_PROXY
              value: "edge"
            - name: KC_HEALTH_ENABLED
              value: "true"
            - name: KC_HTTPS_PORT
              value: "8443"
            - name: PROXY_ADDRESS_FORWARDING
              value: "true"
            - name: KEYCLOAK_FRONTEND_URL
              value: "https://simple-keycloak.apps.cluster.example"
            - name: KC_HTTPS_CERTIFICATE_FILE
              value: "/etc/x509/https/tls.crt"
            - name: KC_HTTPS_CERTIFICATE_KEY_FILE
              value: "/etc/x509/https/tls.key"
          ports:
            - name: http
              containerPort: 8443
            - name: health
              containerPort: 9000
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 9000
              scheme: HTTPS
          volumeMounts:
            - name: keycloak-tls
              mountPath: /etc/x509/https
              readOnly: true
            - name: keycloak-volume
              mountPath: /opt/keycloak/data/import
      volumes:
        - name: keycloak-volume
          configMap:
            name: keycloak-configmap
        - name: keycloak-tls
          secret:
            secretName: keycloak-tls
---
apiVersion: v1
kind: Service
metadata:
  name: keycloak
  labels:
    app: keycloak
spec:
  ports:
    - name: https
      port: 443
      targetPort: 8443
  selector:
    app: keycloak
  type: LoadBalancer
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: keycloak
spec:
  tls:
    - hosts:
        - simple-keycloak.apps.cluster.example
      secretName: keycloak-tls
  rules:
    - host: simple-keycloak.apps.cluster.example
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: keycloak
                port:
                  number: 443